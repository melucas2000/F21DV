<!-- Source: F21DV
     Author: Melanie Lucas
     Date: 18/01/2022 -->

<body></body>

<script src="https://d3js.org/d3.v7.min.js"></script>
<style>
  svg rect {
    fill: blue;
  }

  svg text {
    fill: white;
    font: 10px sans-serif;
    text-anchor: end;
  }
</style>
<script>
  let heartfailurecsv =
    "https://raw.githubusercontent.com/akmand/datasets/master/heart_failure.csv";

  d3.csv(heartfailurecsv, function (row) {
    return row;
    // function waits to be called until function above is read in
  }).then(function (sourceData) {
    // filters through data and returns number of poeple aged between 1 and 30
    const age1And30 = sourceData.filter(function (row) {
      return row.age >= 1 && row.age <= 30;
    });
    // filters through data and returns number of poeple aged 31-40
    const age31And40 = sourceData.filter(function (row) {
      return row.age >= 31 && row.age <= 40;
    });
    // filters through data and returns number of poeple aged 41-60
    const age41And60 = sourceData.filter(function (row) {
      return row.age >= 41 && row.age <= 60;
    });
    // filters through data and returns number of poeple aged 61-100
    const age61And100 = sourceData.filter(function (row) {
      return row.age >= 61 && row.age <= 100;
    });
    //store processed data in variables
    var age1_30 = age1And30.length;
    var age31_40 = age31And40.length;
    var age41_60 = age41And60.length;
    var age61_100 = age61And100.length;
    // store processed variables in array
    var data = [age1_30, age31_40, age41_60, age61_100];

    var width = 300; // sets bar width
    var scaleFactor = 1.5; // set scale factor low to make bar height fit
    var barHeight = 40; // sets bad height
    var graph = d3
      .select("body")
      .append("svg")
      .attr("width", width)
      .attr("height", barHeight * data.length);
    var bar = graph
      .selectAll("g")
      .data(data)
      .enter()
      .append("g")
      .attr("transform", function (d, i) {
        return "translate(0," + i * barHeight + ")";
      });
    bar
      .append("rect")
      .attr("width", function (d) {
        return d * scaleFactor;
      })
      .attr("height", barHeight - 1);
    // appends text and sets spacial appearance
    bar
      .append("text")
      .attr("x", function (d) {
        return d * scaleFactor;
      })
      .attr("y", barHeight / 2)
      .attr("dy", ".35em")
      .text(function (d) {
        return d;
      });
  });
</script>
